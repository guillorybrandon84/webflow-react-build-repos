{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.js","webpack:///external \"cheerio\"","webpack:///external \"path\"","webpack:///./src/libs/index.js","webpack:///./src/libs/fs.js","webpack:///external \"fs\"","webpack:///external \"util\"","webpack:///./src/libs/mkdirp.js","webpack:///external \"fs-extra\"","webpack:///./src/libs/ncp.js","webpack:///./src/libs/reread.js","webpack:///external \"recursive-readdir\"","webpack:///./src/libs/rimraf.js","webpack:///./src/writers/index.js","webpack:///./src/writers/writer.js","webpack:///./src/writers/view-writer.js","webpack:///external \"htmltojsx\"","webpack:///external \"statuses\"","webpack:///external \"uglify-js\"","webpack:///./src/raw/index.js","webpack:///./src/utils/index.js","webpack:///./src/utils/internal.js","webpack:///./src/utils/requireText.js","webpack:///external \"resolve\"","webpack:///./src/writers/script-writer.js","webpack:///external \"node-fetch\"","webpack:///./src/writers/style-writer.js","webpack:///external \"clean-css\""],"names":["defaultPublicSubFolders","transpile","config","inputFiles","outputFiles","Promise","all","fs","readdir","input","then","files","e","console","log","folders","filter","path","extname","file","length","includes","htmlFiles","publicSubDirs","map","folder","scriptWriter","baseUrl","prefetch","styleWriter","source","srouce","transpilingHTMLFiles","transpileHTMLFile","htmlFile","viewWriters","writingFiles","ViewWriter","writeAll","output","src","views","components","meta","layout","controllers","push","paths","write","makingPublicDir","makePublicDir","html","readFile","toString","$","cheerio","load","$head","$body","viewWriter","name","replace","split","segment","charAt","toUpperCase","slice","join","parent","isComponent","setScripts","setStyles","setHTML","publicDir","public","ncp","publicSubDir","filePaths","reread","relativePaths","relativePath","relative","filePath","$scripts","head","find","body","each","i","script","$script","setScript","attr","_","viewsDir","$styles","style","$style","setStyle","$div","mkdir","promisify","stat","unlink","writeFile","mkdirp","copy","remove","Writer","Error","Symbol","htmltojsx","createClass","adjustImagesToRoot","match","removeHtmlFromLinks","href","Internal","pagesDir","componentDir","metaDir","layoutDir","ctrlsDir","indexFilePath","helpersFilePath","routesFilePath","childFilePaths","routes","className","toLowerCase","index","leanViewWriters","vw","forEach","writtingRoutes","freeLint","writingIndex","writingHelpers","raw","viewHelpers","String","comp","children","isNaN","Number","statuses","words","splitWords","Object","assign","ctrlClassName","metaClassName","concat","elName","word","el","$el","$afEl","insertAfter","child","styles","is","scripts","type","test","sockets","socketName","tagName","jsx","convert","trim","bindJSX","constructor","options","fileName","writingChildren","writingSelf","compose","composeApp","composePage","content","resolve","exists","some","sheets","Boolean","css","sheet","escape","_compose","compDir","shouldHaveStyles","composeChildImports","composeProxiesDefault","_composeApp","_composePage","_composeStyleImports","_composeProxiesDefault","socket","defaultType","_composeChildImports","imported","imports","imp","_composeScriptsDeclerations","minified","uglify","minify","code","_composeScriptsInvocations","invoke","freeScope","freeText","camelize","text","letter","self","isList","RegExp","exec","mergeProps","base","sock","attrs","filename","__dirname","requireText","str","quote","importantizeCSS","Array","baseIndent","line","lines","minIndent","reduce","currIndent","Infinity","freeContext","context","args","callArgs","keys","upperFirst","substr","padLeft","char","parseInt","TypeError","Klass","internals","defineProperty","prototype","get","_this","key","value","bind","getOwnPropertyNames","getOwnPropertyDescriptor","publicKey","cache","resolvePath","sync","readFileSync","promise","reject","err","ScriptWriter","dir","composeScriptLoader","scriptFileNames","fetchingScripts","scriptFileName","fetch","res","scriptsIndexContent","_composeScriptLoader","cleanCSS","rebaseTo","StyleWriter","composeStyleLoader","styleFileNames","fetchingStyles","styleFileName","transformSheet","stylesIndexContent","_composeStyleLoader","_transformSheet","url"],"mappings":"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","file":"webflow-react.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import cheerio from 'cheerio';\nimport path from 'path';\n// import git from './legacy/git';\nimport { fs, ncp, reread } from './libs';\nimport { ViewWriter, ScriptWriter, StyleWriter } from './writers';\n\nconst defaultPublicSubFolders = ['css', 'fonts', 'images', 'js'];\n\nexport const transpile = async config => {\n    let inputFiles;\n    let outputFiles = [];\n\n    try {\n        await Promise.all([\n            fs.readdir(config.input).then(files => {\n                inputFiles = files;\n            }),\n            // git.removeWFRFiles(config).then(files => {\n            //     outputFiles.push(...files);\n            // }),\n        ]);\n    } catch (e) {\n        console.log(e);\n    }\n\n    const folders = inputFiles.filter(\n        file =>\n            !path.extname(file).length &&\n            !defaultPublicSubFolders.includes(file)\n    );\n\n    let htmlFiles;\n\n    // Get the public directories for \"css\", \"fonts\", \"images\", \"js\".\n    const publicSubDirs = inputFiles.filter(\n        file => !path.extname(file) && defaultPublicSubFolders.includes(file)\n    );\n\n    // Map the directory files.\n    folders.map(folder =>\n        fs\n            // Read the directories.\n            .readdir(`${config.input}/${folder}`)\n\n            // Map the input files.\n            .then(files => {\n                inputFiles = [\n                    ...(inputFiles || []),\n                    ...(files || []).map(file => `${folder}/${file}`),\n                ];\n            })\n\n            // Filter only HTML files.\n            .then(() => {\n                htmlFiles = inputFiles.filter(\n                    file => path.extname(file) == '.html'\n                );\n            })\n\n            // Execute the writers.\n            .then(async () => {\n                const scriptWriter = new ScriptWriter({\n                    baseUrl: config.input,\n                    prefetch: config.prefetch,\n                });\n\n                const styleWriter = new StyleWriter({\n                    baseUrl: config.input,\n                    prefetch: config.prefetch,\n                    source: config.srouce,\n                });\n\n                const transpilingHTMLFiles = htmlFiles.map(htmlFile => {\n                    return transpileHTMLFile(\n                        config,\n                        htmlFile,\n                        scriptWriter,\n                        styleWriter\n                    );\n                });\n\n                const viewWriters = await Promise.all(transpilingHTMLFiles);\n\n                const writingFiles = await Promise.all([\n                    ViewWriter.writeAll(\n                        viewWriters,\n                        config.output.src.views,\n                        config.output.src.components,\n                        config.output.src.meta,\n                        config.output.src.layout,\n                        config.output.src.controllers\n                    ).then(paths => outputFiles.push(...paths)),\n                    scriptWriter\n                        .write(config.output.src.layout + '/App/scripts')\n                        .then(paths => outputFiles.push(...paths)),\n                    styleWriter\n                        .write(config.output.src.layout + '/App/styles')\n                        .then(paths => outputFiles.push(...paths)),\n                ]);\n\n                const makingPublicDir = makePublicDir(\n                    config,\n                    publicSubDirs\n                ).then(paths => outputFiles.push(...paths));\n\n                try {\n                    await Promise.all([writingFiles, makingPublicDir]);\n                } catch (e) {\n                    console.log(e);\n                }\n\n                // TODO: Enable Git?\n                // return git.add(outputFiles, config).then(files => {\n                //     return git.commit(files, 'Updated');\n                // });\n            })\n    );\n};\n\nconst transpileHTMLFile = async (\n    config,\n    htmlFile,\n    scriptWriter,\n    styleWriter\n) => {\n    const html = (await fs.readFile(`${config.input}/${htmlFile}`)).toString();\n    const $ = cheerio.load(html);\n    const $head = $('head');\n\n    if (htmlFile == 'index.html') {\n        htmlFile = 'home.html';\n    }\n\n    if (!!scriptWriter && !!styleWriter) {\n        // pass\n    }\n\n    const $body = $('body');\n\n    const viewWriter = new ViewWriter({\n        name: htmlFile\n            .replace('.html', '')\n            .split('/')\n            .map(segment => {\n                return segment.charAt(0).toUpperCase() + segment.slice(1);\n            })\n            .join(''),\n        baseUrl: config.baseUrl,\n        parent:\n            htmlFile.split('/')[0] === htmlFile ? null : htmlFile.split('/')[0],\n        isComponent: false,\n        source: config.source,\n    });\n\n    setScripts(scriptWriter, $head, $, $body);\n    setStyles(viewWriter, styleWriter, $head, $, config.output.src.views);\n    setHTML(viewWriter, $body, $);\n\n    return viewWriter;\n};\n\nconst makePublicDir = async (config, publicSubDirs) => {\n    const publicDir = config.output.public;\n    await Promise.all(\n        publicSubDirs.map(publicSubDir => {\n            return ncp(\n                `${config.input}/${publicSubDir}`,\n                `${publicDir}/${publicSubDir}`\n            );\n        })\n    );\n\n    // Resolving relative paths\n    const filePaths = await reread(config.input);\n\n    const relativePaths = filePaths.map(filePath => {\n        const relativePath = path.relative(config.input, filePath);\n\n        return `${publicDir}/${relativePath}`;\n    });\n\n    return relativePaths;\n};\n\nconst setScripts = (scriptWriter, $head, $, $body) => {\n    const $scripts = {\n        head: $head.find('script[type=\"text/javascript\"]'),\n        body: $body.find('script[type=\"text/javascript\"]'),\n    };\n\n    if ($scripts.head.length) {\n        $scripts.head.each((i, script) => {\n            const $script = $head.find(script);\n            scriptWriter.setScript($script.attr('src'), $script.html());\n        });\n    }\n\n    if ($scripts.body.length) {\n        $scripts.body.each((i, script) => {\n            const $script = $body.find(script);\n            scriptWriter.setScript($script.attr('src'), $script.html());\n        });\n    }\n};\n\nconst setStyles = (viewWriter, styleWriter, $head, _, viewsDir) => {\n    let $styles;\n\n    $styles = $head.find('link[rel=\"stylesheet\"][type=\"text/css\"]');\n\n    $styles.each((i, style) => {\n        const $style = $head.find(style);\n\n        viewWriter.setStyle($style.attr('href'), $style.html(), viewsDir);\n        styleWriter.setStyle($style.attr('href'), $style.html());\n    });\n\n    $styles = $head.find('style');\n\n    $styles.each((i, style) => {\n        const $style = $head.find(style);\n\n        viewWriter.setStyle($style.attr('href'), $style.html(), viewsDir);\n        styleWriter.setStyle($style.attr('href'), $style.html());\n    });\n};\n\nconst setHTML = (viewWriter, $body, $) => {\n    // Create a wrap around $body so we can inherit its style without actually\n    // using a <body> tag\n    const $div = $('<div>');\n    $div.html($body.html());\n    $div.attr($body.attr());\n    viewWriter.html = $.html($div);\n};\n","module.exports = require(\"cheerio\");","module.exports = require(\"path\");","export { default as fs } from './fs';\nexport { default as mkdirp } from './mkdirp';\nexport { default as ncp } from './ncp';\nexport { default as reread } from './reread';\nexport { default as rimraf } from './rimraf';\n","import fs from 'fs';\nimport { promisify } from 'util';\n\nexport const mkdir = promisify(fs.mkdir);\nexport const readdir = promisify(fs.readdir);\nexport const readFile = promisify(fs.readFile);\nexport const stat = promisify(fs.stat);\nexport const unlink = promisify(fs.unlink);\nexport const writeFile = promisify(fs.writeFile);\n\nexport default {\n    mkdir,\n    readdir,\n    readFile,\n    stat,\n    unlink,\n    writeFile,\n};\n","module.exports = require(\"fs\");","module.exports = require(\"util\");","import fs from 'fs-extra';\nimport { promisify } from 'util';\n\nexport default promisify(fs.mkdirp);\n","module.exports = require(\"fs-extra\");","import fs from 'fs-extra';\nimport { promisify } from 'util';\n\nexport default promisify(fs.copy);\n","import reread from 'recursive-readdir';\nimport { promisify } from 'util';\n\nexport default promisify(reread);\n","module.exports = require(\"recursive-readdir\");","import fs from 'fs-extra';\nimport { promisify } from 'util';\n\nexport default promisify(fs.remove);\n","export { default as Writer } from './writer';\nexport { default as ViewWriter } from './view-writer';\nexport { default as ScriptWriter } from './script-writer';\nexport { default as StyleWriter } from './style-writer';\n","class Writer {\n    write() {\n        throw Error('Writer.write() must be implemented');\n    }\n}\n\nexport default Writer;\n","import cheerio from 'cheerio';\nimport HTMLtoJSX from 'htmltojsx';\nimport path from 'path';\nimport statuses from 'statuses';\nimport uglify from 'uglify-js';\nimport { fs, mkdirp } from '../libs';\nimport raw from '../raw';\nimport Writer from './writer';\n\nconst writingFiles = [];\n\n// Attempt at supporting windows by monkey patching path.relative to prevent backslashes.\n// const orPathRel = path.relative;\n// path.relative = (from, to) => orPathRel(from, to).replace(/\\\\/gi, '/');\n\nimport {\n    escape,\n    freeLint,\n    freeScope,\n    freeText,\n    Internal,\n    splitWords,\n    upperFirst,\n} from '../utils';\n\nconst _ = Symbol('_ViewWriter');\nconst htmltojsx = new HTMLtoJSX({ createClass: false });\n\n// const flattenChildren = (children = [], flatten = []) => {\n//   children.forEach(child => {\n//     flattenChildren(child[_].children, flatten);\n//   });\n\n//   flatten.push(...children);\n\n//   return flatten;\n// };\n\n// Replace anchor link roots to relative.\n// html.replace(\n//     /<a.+?href=\"(.+?)\".+?(?!target=\"_blank\").+?>/g,\n//     (match, href) => {\n//         return match.replace(href, '/' + href);\n//     }\n// );\n\n// // Replace image roots to relative.\n// html.replace(/<img.+?src=\"(.+?)\".+?>/g, (match, src) => {\n//     return match.replace(src, '/' + src);\n// });\n\nconst adjustImagesToRoot = html => {\n    return html.replace(/<img.+?src=\"(.+?)\".+?>/g, (match, src) => {\n        return match.replace(src, '/' + src);\n    });\n};\n\nconst removeHtmlFromLinks = html => {\n    return adjustImagesToRoot(\n        html\n            .replace('index.html', '')\n            .replace(/\\.html/gi, '')\n            .replace(\n                /<a.+?href=\"(.+?)\".+?(?!target=\"_blank\").+?>/g,\n                (match, href) => {\n                    return match.replace(href, '/' + href);\n                }\n            )\n    );\n};\n\n@Internal(_)\nclass ViewWriter extends Writer {\n    static async writeAll(\n        viewWriters,\n        pagesDir,\n        componentDir,\n        metaDir,\n        layoutDir,\n        ctrlsDir\n    ) {\n        // Create the directories if they do not exist.\n        await mkdirp(pagesDir);\n        await mkdirp(componentDir);\n        await mkdirp(layoutDir);\n        await mkdirp(metaDir);\n\n        // Declare file paths for index, helpers and routes.\n        const indexFilePath = `${pagesDir}/index.js`;\n        const helpersFilePath = `${pagesDir}/../helpers.js`;\n        const routesFilePath = `${pagesDir}/../routes.js`;\n        const childFilePaths = [indexFilePath, helpersFilePath, routesFilePath];\n\n        // Get the relative controls dir.\n        ctrlsDir = path.relative(pagesDir, ctrlsDir);\n\n        // Prepare the \"routes.js\" template.\n        const routes = `\t\n            import React from 'react';\t\n            import { Route, BrowserRouter } from 'react-router-dom';\t\n            import * as Views from './views';\n\n            ${viewWriters\n                .map(viewWriter => {\n                    return `export const ${viewWriter.className\n                        .replace(/view/gi, '')\n                        .toUpperCase()} = '${\n                        viewWriter.parent ? `/${viewWriter.parent}` : ''\n                    }/${viewWriter.className\n                        .replace(/home/gi, '')\n                        .replace(/view/gi, '')\n                        .split(/(?=[A-Z])/)\n                        .slice(-1)[0]\n                        .toLowerCase()}';`;\n                })\n                .join('\\n  ')}\n        \n            const Router = () => (\n                <BrowserRouter>\n                ${viewWriters\n                    .map(\n                        viewWriter =>\n                            `<Route key=\"${viewWriter.className.replace(\n                                /view/gi,\n                                ''\n                            )}\" path={ ${viewWriter.className\n                                .replace(/view/gi, '')\n                                .toUpperCase()} } component={Views.${\n                                viewWriter.className\n                            }.Controller} exact />`\n                    )\n                    .join('\\n')}\n                </BrowserRouter>\n            );\n            \n            export default Router;`;\n\n        // Prepare the views \"index.js\" template.\n        const index = viewWriters\n            .map(viewWriter => {\n                return `export { default as ${viewWriter.className} } from './${viewWriter.className}'`;\n            })\n            .join('\\n');\n\n        const leanViewWriters = [];\n        // viewWriters = flattenChildren(viewWriters);\n\n        for (const viewWriter of viewWriters) {\n            if (\n                !leanViewWriters.find(\n                    vw => vw.className === viewWriter.className\n                )\n            ) {\n                leanViewWriters.push(viewWriter);\n            }\n        }\n        leanViewWriters.forEach(async viewWriter => {\n            const filePaths = await viewWriter.write(\n                pagesDir,\n                componentDir,\n                metaDir,\n                ctrlsDir,\n                layoutDir\n            );\n            childFilePaths.push(...filePaths);\n        });\n\n        const writtingRoutes = fs.writeFile(routesFilePath, freeLint(routes));\n        const writingIndex = fs.writeFile(indexFilePath, freeLint(index));\n        const writingHelpers = fs.writeFile(helpersFilePath, raw.viewHelpers);\n\n        await Promise.all([writingIndex, writingHelpers, writtingRoutes]);\n        return childFilePaths;\n    }\n\n    get baseUrl() {\n        return this[_].baseUrl;\n    }\n\n    set baseUrl(baseUrl) {\n        this[_].baseUrl = String(baseUrl);\n    }\n\n    set isComponent(comp) {\n        this[_].isComponent = comp;\n    }\n\n    get isComponent() {\n        return this[_].isComponent;\n    }\n\n    get children() {\n        return this[_].children.slice();\n    }\n\n    set name(name) {\n        if (!isNaN(Number(name))) {\n            name = statuses[name];\n        }\n\n        const words = splitWords(name);\n        Object.assign(this[_], {\n            ctrlClassName: words.map(upperFirst).join(''),\n            metaClassName: words\n                .concat('meta')\n                .map(upperFirst)\n                .join(''),\n            className: words\n                // .concat('view')\n                .map(upperFirst)\n                .join(''),\n            elName: words.map(word => word.toLowerCase()).join('-'),\n            name: words\n                .concat('view')\n                .map(word => word.toLowerCase())\n                .join('-'),\n        });\n    }\n\n    get name() {\n        return this[_].name;\n    }\n\n    get ctrlClassName() {\n        return this[_].ctrlClassName;\n    }\n\n    get metaClassName() {\n        return this[_].metaClassName;\n    }\n\n    get className() {\n        return this[_].className;\n    }\n\n    get elName() {\n        return this[_].elName;\n    }\n\n    set html(html) {\n        if (!html) {\n            this[_].html = '';\n            this[_].children = [];\n            return;\n        }\n\n        const children = (this[_].children = []);\n        const $ = cheerio.load(html);\n\n        // console.log(this[_].className, ($(\"[wfr-c]\") || []).length)\n\n        let el = $('[wfr-c]')[0];\n        while (el) {\n            const $el = $(el);\n            const elName = $el.attr('wfr-c');\n            const $afEl = $(`<af-${elName}></af-${elName}>`);\n            // const sock = $el.attr(\"wfr-d\");\n            // $afEl.attr(\"wfr-d\", $el.attr(\"wfr-d\"));\n            $el.attr('wfr-c', null);\n            $el.attr('wfr-props', 'binder');\n            // $el.attr(\"wfr-d\", null);\n            $afEl.insertAfter($el);\n            // if (sock !== null && sock !== undefined) {\n            //   $el.prepend(`<span wfr-d=\"${sock}\">`);\n            //   $el.append('</span>');\n            // }\n            $el.remove();\n\n            const child = new ViewWriter({\n                name: elName,\n                html: $.html($el),\n                baseUrl: this.baseUrl,\n                styles: this.styles,\n                isComponent: true,\n            });\n\n            children.push(child);\n            el = $('[wfr-c]')[0];\n        }\n\n        // Apply ignore rules AFTER child elements were plucked\n        $('[wfr-ignore]').remove();\n\n        // Empty inner HTML\n        $('[wfr-empty]')\n            .html('')\n            .attr('wfr-empty', null);\n\n        // Add rel=\"noopener noreferrer\" to target=\"_blank\" links.\n        // $('[target=\"_blank]').each(function() {\n        //     if (!$(this).is('[rel=\"noopener noreferrer\"]')) {\n        //         $(this).attr('rel', 'noopener noreferrer');\n        //     }\n        // });\n\n        // // Function to replace tags.\n        // $.fn.replaceTagName = function(f) {\n        //     var g = [],\n        //         h = this.length;\n        //     while (h--) {\n        //         var k = document.createElement(f),\n        //             b = this[h],\n        //             d = b.attributes;\n        //         for (var c = d.length - 1; c >= 0; c--) {\n        //             var j = d[c];\n        //             k.setAttribute(j.name, j.value);\n        //         }\n        //         k.innerHTML = b.innerHTML;\n        //         $(b)\n        //             .after(k)\n        //             .remove();\n        //         g[h - 1] = k;\n        //     }\n        //     return $(g);\n        // };\n\n        // // Replace # anchors with buttons.\n        // $('a').each(function() {\n        //     if ($(this).is('[href=\"#\"]') || !$(this).is('[href]')) {\n        //         $(this)\n        //             .removeAttr('href')\n        //             .replaceTagName('button');\n        //     }\n        // });\n\n        // Default actions for forms.\n        $('form').each(function() {\n            if (!$(this).is('[action]')) {\n                $(this).attr('action', '/');\n            }\n        });\n\n        this[_].scripts = [];\n\n        // Set inline scripts. Will be loaded once component has been mounted\n        $('script').each((i, script) => {\n            const $script = $(script);\n            const src = $script.attr('src');\n            const type = $script.attr('type');\n\n            // We're only interested in JavaScript script tags\n            if (type && !/javascript/i.test(type)) return;\n\n            if (src) {\n                this[_].scripts.push({\n                    type: 'src',\n                    body: src,\n                });\n            } else {\n                this[_].scripts.push({\n                    type: 'code',\n                    body: $script.html(),\n                });\n            }\n\n            $script.remove();\n        });\n\n        const $body = $('body');\n\n        html = $body.html();\n\n        this[_].html = html;\n\n        const sockets = (this[_].sockets = []);\n\n        // Find root sockets\n        $('[wfr-d]').each((i, el) => {\n            const $el = $(el);\n            const socketName = $el.attr('wfr-d');\n            sockets.push(socketName);\n\n            $el.attr('wfr-d', null);\n            // Workaround would help identify the closing tag\n            el.tagName += `-wfr-d-${socketName}`;\n        });\n\n        // Refetch modified html\n        html = $body.html();\n\n        // Transforming HTML into JSX\n        let jsx = htmltojsx.convert(removeHtmlFromLinks(html)).trim();\n\n        // Bind controller to view\n        this[_].jsx = bindJSX(this, jsx, children);\n    }\n\n    get scripts() {\n        return this[_].scripts ? this[_].scripts.slice() : [];\n    }\n\n    get styles() {\n        return this[_].styles.slice();\n    }\n\n    get html() {\n        return this[_].html;\n    }\n\n    get jsx() {\n        return this[_].jsx;\n    }\n\n    get sockets() {\n        return this[_].sockets && [...this[_].sockets];\n    }\n\n    get source() {\n        return this[_].source;\n    }\n\n    set source(source) {\n        this[_].source = String(source);\n    }\n\n    constructor(options) {\n        super();\n\n        this[_].children = [];\n        this[_].styles = options.styles || [];\n\n        this.name = options.name;\n        this.parent = options.parent;\n        this.isComponent = options.isComponent;\n        this.html = options.html;\n        this.source = options.source;\n    }\n\n    async write(pagesDir, componentDir, metaDir, ctrlsDir, layoutDir = null) {\n        // Check if the artefact is a \"page\" or \"component\".\n        const isComponent = pagesDir === componentDir;\n        const fileName = this.className;\n\n        // Set the file path.\n        const filePath = `${pagesDir}/${fileName}/index.js`;\n\n        // Set children file paths.\n        const childFilePaths = [filePath];\n\n        // Set children writer.\n        const writingChildren = this[_].children.map(async child => {\n            if (!writingFiles.includes(child.className)) {\n                writingFiles.push(child.className);\n                const filePaths = await child.write(\n                    componentDir,\n                    componentDir,\n                    metaDir,\n                    ctrlsDir\n                );\n                childFilePaths.push(...filePaths);\n            }\n        });\n\n        // Write the files.\n        let writingSelf;\n        if (!writingFiles.includes(`${fileName}/index.js`)) {\n            try {\n                await mkdirp(pagesDir + '/' + this.className);\n                await fs.readFile(`${pagesDir}/${fileName}/index.js`);\n            } catch (e) {\n                writingSelf = fs.writeFile(\n                    `${pagesDir}/${fileName}/index.js`,\n                    this[_].compose(\n                        path.relative(pagesDir, componentDir),\n                        path.relative(pagesDir, metaDir),\n                        ctrlsDir,\n                        !isComponent\n                    )\n                );\n            }\n        }\n\n        try {\n            await Promise.all([...writingChildren, writingSelf]);\n        } catch (e) {\n            console.log(e);\n        }\n\n        // Create the <App /> component inside the layout folder.\n        if (layoutDir) {\n            try {\n                await mkdirp(layoutDir + '/App');\n                await fs.readFile(`${layoutDir}/App/index.js`);\n            } catch (e) {\n                writingSelf = fs.writeFile(\n                    `${layoutDir}/App/index.js`,\n                    this[_].composeApp()\n                );\n            }\n        }\n\n        // Create the <Page /> component inside the layout folder.\n        if (layoutDir) {\n            try {\n                await mkdirp(layoutDir + '/Page');\n                await fs.readFile(`${layoutDir}/Page/index.js`);\n            } catch (e) {\n                writingSelf = fs.writeFile(\n                    `${layoutDir}/Page/index.js`,\n                    this[_].composePage()\n                );\n            }\n        }\n\n        return childFilePaths;\n    }\n\n    async setStyle(href, content, viewsDir) {\n        let type;\n        let body;\n\n        if (href) {\n            type = 'href';\n            body = /^\\w+:\\/\\//.test(href) ? href : path.resolve('/', href);\n        } else {\n            type = 'sheet';\n            body = content;\n        }\n\n        const exists = this[_].styles.some(style => {\n            return style.body == body;\n        });\n\n        if (!exists) {\n            this[_].styles.push({ type, body });\n        }\n\n        const sheets = this[_].styles\n            .map(({ type, body }) => {\n                return type == 'sheet' && body;\n            })\n            .filter(Boolean);\n\n        let css = '';\n\n        // css += hrefs.map((href) => {\n        //   return `@import url(${href});`\n        // }).join('\\n')\n\n        css += '\\n\\n';\n\n        css += sheets\n            .map(sheet => {\n                return sheet;\n            })\n            .join('\\n\\n');\n        if (!viewsDir || !css.length) return true;\n        try {\n            await mkdirp(viewsDir + '/' + this.className + '/styles');\n            await fs.writeFile(\n                `${viewsDir}/${this.className}/styles/index.css`,\n                escape(css.trim())\n            );\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    _compose(compDir, metaDir, ctrlsDir, shouldHaveStyles = true) {\n        // Adjust the controllers directory.\n        ctrlsDir = '../' + ctrlsDir;\n        if (this[_].isComponent) {\n            ctrlsDir += '/components';\n        } else {\n            ctrlsDir += '/views';\n        }\n\n        // Return the composed template.\n        return freeLint(`\n            import React from 'react'\n\n            ${\n                // Add helpers if the component has data sockets.\n                this[_].sockets.length\n                    ? `import { map, transformProxies } from '../../helpers'`\n                    : ''\n            }\n\n            ${\n                // Add CSS imports if the page has styles.\n                shouldHaveStyles ? `import \"./styles/index.css\"\\n` : '\\n'\n            }\n\n            ==>${this[_].composeChildImports(compDir)}<==\n\n            let Controller\n\n            class ${this.className} extends React.Component {\n                static get Controller() {\n                if (Controller) return Controller\n\n                try {\n                    Controller = require('${ctrlsDir}/${this.ctrlClassName}')\n                    Controller = Controller.default || Controller\n\n                    return Controller\n                }\n                catch (e) {\n                    if (e.code === 'MODULE_NOT_FOUND') {\n                    Controller = ${this.className}\n\n                    return Controller\n                    }\n\n                    throw e\n                }\n            }\n\n            render() {\n\n                ${\n                    // Render the proxies if the component has data sockets.\n                    this[_].sockets.length\n                        ? `const proxies = Controller !== ${\n                              this.className\n                          } ? transformProxies(this.props) : {\n                    ==>${this[_].composeProxiesDefault()}<==\n                }`\n                        : ''\n                }\n\n                ${\n                    // Render metadata if this is a page.\n                    this[_].isComponent\n                        ? ''\n                        : `\n                            let Metadata\n                            try {\n                                // eslint-disable-next-line\n                                Metadata = require(\"${metaDir}/${this.metaClassName}\")\n                                Metadata = Metadata.default || Metadata\n                            } catch (e) {\n                                // pass\n                                Metadata = null;\n                            }\n                            try {\n                                // eslint-disable-next-line\n                                Metadata = require(\"${metaDir}/defaultMeta\")\n                                Metadata = Metadata.default || Metadata\n                            } catch (e) {\n                                // pass\n                                Metadata = null;\n                            }\n                        `\n                }\n\n                return (\n                    \n                        ${\n                            // Render metadata if this is a page.\n                            !this[_].isComponent\n                                ? `\n                                <React.Fragment>\n                                    {Metadata ? <Metadata {...this.props} /> : null}\n                                    ==>${this.jsx}<==\n                                </React.Fragment>`\n                                : `\n                                ==>${this.jsx}<==\n                            `\n                        }\n                        \n                    \n                )\n            }\n        }\n\n        export default ${this.className}\n    `);\n    }\n\n    _composeApp() {\n        return freeLint(`\n            import React from 'react';\n            import Router from '../../routes.js';\n\n            import './styles';\n            import './scripts';\n\n            const App = () => <Router />;\n\n            export default App;\n        `);\n    }\n\n    _composePage() {\n        return freeLint(`\n            import React from 'react';\n\n            const Page = () => {\n               return (\n                   <div></div>\n               );\n            };\n\n            export default Page;\n        `);\n    }\n\n    _composeStyleImports() {\n        // const hrefs = this[_].styles.map(({ type, body }) => {\n        //   return type == 'href' && body\n        // }).filter(Boolean)\n\n        const sheets = this[_].styles\n            .map(({ type, body }) => {\n                return type == 'sheet' && body;\n            })\n            .filter(Boolean);\n\n        let css = '';\n\n        css += '\\n\\n';\n\n        css += sheets\n            .map(sheet => {\n                return sheet;\n            })\n            .join('\\n\\n');\n\n        return escape(css.trim());\n    }\n\n    _composeProxiesDefault() {\n        return this[_].sockets\n            .map(socket => {\n                let defaultType = '[]';\n\n                if (socket.includes('%string%')) {\n                    socket = socket.replace('%string%', '');\n                    defaultType = \"''\";\n                }\n\n                return `'${socket}': ` + defaultType + `,`;\n            })\n            .join('\\n');\n    }\n\n    _composeChildImports(compDir) {\n        if (!compDir) {\n            compDir = '..';\n        } else {\n            compDir = '../' + compDir;\n        }\n        const imported = [];\n\n        const imports = this[_].children\n            .map(child => {\n                if (!imported.includes(child.className)) {\n                    imported.push(child.className);\n                    return `import ${child.className} from '${compDir}/${child.className}'`;\n                }\n            })\n            .filter(imp => !!imp && imp.length);\n\n        // Line skip\n        imports.push('');\n\n        return imports.length ? imports.join('\\n') : '';\n    }\n\n    _composeScriptsDeclerations() {\n        return this[_].scripts\n            .map(script => {\n                if (script.type == 'src') {\n                    return `fetch(\"${script.body}\").then(body => body.text()),`;\n                }\n\n                const minified = uglify.minify(script.body).code;\n                // Unknown script format ??? fallback to maxified version\n                const code = minified || script.body;\n\n                return `Promise.resolve(\"${escape(code)}\"),`;\n            })\n            .join('\\n');\n    }\n\n    _composeScriptsInvocations() {\n        if (!this[_].scripts) return '';\n\n        const invoke = freeScope('eval(arguments[0])', 'window', {\n            script: null,\n        });\n\n        return freeText(`\n      scripts.concat(Promise.resolve()).reduce((loaded, loading) => {\n        return loaded.then((script) => {\n          ==>${invoke}<==\n\n          return loading\n        })\n      })\n    `);\n    }\n}\n\nfunction camelize(text) {\n    return text\n        .replace(/(?:^\\w|[A-Z]|\\b\\w)/g, function(letter, index) {\n            return index == 0 ? letter.toLowerCase() : letter.toUpperCase();\n        })\n        .replace(/\\s+/g, '');\n}\n\nfunction bindJSX(self, jsx, children = []) {\n    // DETECT LIST\n    children.forEach((child, index) => {\n        const isList = new RegExp(`(<af-${child.elName} />\\\\s*){2,}`, '').exec(\n            jsx\n        );\n        if (isList) {\n            self[_].sockets.push(`${camelize(child.className)}List${index}`);\n            jsx = jsx.replace(\n                new RegExp(`(<af-${child.elName} />\\\\s*){2,}`, ''),\n                `{map(proxies['${camelize(\n                    child.className\n                )}List${index}'], props => <React.Fragment ${mergeProps(\n                    ''\n                )}>{props.children ? props.children : null}</React.Fragment>)}`\n            );\n        } else {\n            // Bind controllers to children.\n            jsx = jsx.replace(\n                new RegExp(`af-${child.elName}`, 'g'),\n                `${child.className}.Controller {...this.props}`\n            );\n\n            jsx = jsx.replace(\n                new RegExp(\n                    `(<af-${child.elName} />\\\\s*)+`,\n                    !self[_].isComponent ? 'g' : ''\n                ),\n                !self[_].isComponent\n                    ? `<${child.className}.Controller {...this.props}/>`\n                    : `{map(proxies['${child.className}'], props => <${\n                          child.className\n                      }.Controller ${mergeProps(\n                          ''\n                      )}>{props.children ? props.children : null}</${\n                          child.className\n                      }.Controller>)}`\n            );\n        }\n    });\n\n    // ORDER MATTERS\n    // Open close\n    return (\n        jsx\n            // Attach props\n            .replace(/(wfr-props=\".*?\")/g, (match, base) =>\n                match.replace(base, '{ ...this.props }')\n            )\n            // Open close\n            .replace(\n                /<([\\w_-]+)-wfr-d-([\\w_-]+)(.*?)>([^]*)<\\/\\1-wfr-d-\\2>/g,\n                (match, el, sock, attrs, children) => {\n                    return /<[\\w_-]+-wfr-d-[\\w_-]+/.test(children)\n                        ? `{map(proxies['${sock}'], props => <${el} ${mergeProps(\n                              attrs\n                          )}>{createScope(props.children, proxies => <React.Fragment>\n                            {props.topelement ? props.topelement() : null}\n                            ${bindJSX(\n                                self,\n                                children\n                            )}</React.Fragment>)}</${el}>)}`\n                        : `{map(proxies['${sock}'], props => <${el} ${mergeProps(\n                              attrs\n                          )}>{props.children ? props.children : <React.Fragment>${children}</React.Fragment>}</${el}>)}`;\n                }\n            )\n            // Self closing\n            .replace(\n                /<([\\w_-]+)-wfr-d-([\\w_-]+)(.*?) \\/>/g,\n                (match, el, sock, attrs) =>\n                    `{map(proxies['${sock}'], props => <${el} ${mergeProps(\n                        attrs\n                    )}>{props.children}</${el}>)}`\n            )\n    );\n}\n\n// Merge props along with class name\nfunction mergeProps(attrs) {\n    attrs = attrs.trim();\n\n    if (!attrs) {\n        return '{...props}';\n    }\n\n    let className = attrs.match(/className=\"([^\"]+)\"/);\n\n    if (!className) {\n        return `${attrs} {...props}`;\n    }\n\n    className = className[1];\n    attrs = attrs.replace(/ ?className=\"[^\"]+\"/, '');\n\n    return `${attrs} {...{...props, className: \\`${className} $\\{props.className || ''}\\`}}`.trim();\n}\n\nexport default ViewWriter;\n","module.exports = require(\"htmltojsx\");","module.exports = require(\"statuses\");","module.exports = require(\"uglify-js\");","import path from 'path';\nimport { requireText } from '../utils';\n\nconst resolve = filename => path.resolve(__dirname, '../src/raw', filename);\n\n// Exporting an object since we're dealing with a getter\nexport default {\n    get viewHelpers() {\n        return requireText(resolve('viewHelpers.js'));\n    },\n};\n","export { default as Internal } from './internal';\nexport { default as requireText } from './requireText';\n\n// Useful for nested strings that should be evaluated\nexport const escape = (str, quote) => {\n    str = str.replace(/\\\\/g, '\\\\\\\\');\n\n    switch (quote) {\n        case \"'\":\n            return str.replace(/'/g, \"\\\\'\");\n        case '\"':\n            return str.replace(/\"/g, '\\\\\"');\n        case '`':\n            return str.replace(/`/g, '\\\\`');\n        default:\n            return str\n                .replace(/'/g, \"\\\\'\")\n                .replace(/\"/g, '\\\\\"')\n                .replace(/`/g, '\\\\`');\n    }\n};\n\nexport const importantizeCSS = css => {\n    return css.replace(/(!important)?;/gi, ' !important;');\n};\n\n// Will use the shortest indention as an axis\nexport const freeText = text => {\n    if (text instanceof Array) {\n        text = text.join('');\n    }\n\n    // This will allow inline text generation with external functions, same as ctrl+shift+c\n    // As long as we surround the inline text with ==>text<==\n    text = text.replace(\n        /( *)==>((?:.|\\n)*?)<==/g,\n        (match, baseIndent, content) => {\n            return content\n                .split('\\n')\n                .map(line => `${baseIndent}${line}`)\n                .join('\\n');\n        }\n    );\n\n    const lines = text.split('\\n');\n\n    const minIndent = lines\n        .filter(line => line.trim())\n        .reduce((minIndent, line) => {\n            const currIndent = line.match(/^ */)[0].length;\n\n            return currIndent < minIndent ? currIndent : minIndent;\n        }, Infinity);\n\n    return lines\n        .map(line => line.slice(minIndent))\n        .join('\\n')\n        .trim()\n        .replace(/\\n +\\n/g, '\\n\\n');\n};\n\n// Calls freeText() and disables lint\nexport const freeLint = script => {\n    return freeText(`==>${freeText(script)}<==`);\n};\n\n// Calls freeLint() and ensures that 'this' is represented by window\nexport const freeContext = script => {\n    return freeLint(`\n    (function() {\n\n    ==>${freeText(script)}<==\n\n    }).call(window)\n  `);\n};\n\n// Creates a completely isolated scope with Function constructor.\n// args is a varToInject-injectedVarName map.\nexport const freeScope = (script, context = 'window', args = {}) => {\n    const callArgs = [context].concat(Object.keys(args));\n\n    return freeText(`\n    new Function(\\`\n      with (this) {\n        ${script}\n      }\n    \\`).call(${callArgs.join(', ')})\n  `);\n};\n\n// upper -> Upper\nexport const upperFirst = str => {\n    return str.substr(0, 1).toUpperCase() + str.substr(1);\n};\n\n// foo_barBaz -> ['foo', 'bar', 'Baz']\nexport const splitWords = str => {\n    return str\n        .replace(/[A-Z]/, ' $&')\n        .split(/[^a-zA-Z0-9]+/)\n        .filter(word => word.trim());\n};\n\n// abc 5 0 -> 00abc\nexport const padLeft = (str, length, char = ' ') => {\n    str = String(str);\n    length = parseInt(length + 1 - str.length);\n\n    return Array(length).join(char) + str;\n};\n","const Internal = _ => {\n    if (typeof _ != 'symbol') {\n        throw TypeError('Accessor must me a symbol');\n    }\n\n    return Klass => {\n        if (typeof Klass != 'function') {\n            throw TypeError('Provided target is not a class');\n        }\n\n        const internals = {};\n\n        Object.defineProperty(Klass.prototype, _, {\n            get() {\n                const _this = { ...internals };\n\n                Object.keys(_this).forEach(key => {\n                    const value = _this[key];\n\n                    if (typeof value == 'function') {\n                        _this[key] = value.bind(this);\n                    }\n                });\n\n                Object.defineProperty(this, _, {\n                    value: _this,\n                });\n\n                return _this;\n            },\n        });\n\n        Object.getOwnPropertyNames(Klass.prototype).forEach(key => {\n            if (key[0] != '_') return;\n\n            const { value } = Object.getOwnPropertyDescriptor(\n                Klass.prototype,\n                key\n            );\n\n            if (typeof value != 'function') return;\n\n            const publicKey = key.slice(1);\n            internals[publicKey] = value;\n            delete Klass.prototype[key];\n        });\n    };\n};\n\nexport default Internal;\n","import { readFile, readFileSync } from 'fs';\nimport resolvePath from 'resolve';\n\nconst cache = {};\n\nconst requireText = path => {\n    path = resolvePath.sync(path);\n\n    return (cache[path] = cache[path] || readFileSync(path).toString());\n};\n\nrequireText.promise = path =>\n    new Promise((resolve, reject) => {\n        resolvePath(path, (err, path) => {\n            if (err) {\n                return reject(err);\n            }\n\n            let content = cache[path];\n\n            if (content) {\n                return resolve(content);\n            }\n\n            readFile(path, (err, content) => {\n                if (err) {\n                    return reject(err);\n                }\n\n                cache[path] = content = content.toString();\n\n                resolve(content);\n            });\n        });\n    });\n\nexport default requireText;\n","module.exports = require(\"resolve\");","import fetch from 'node-fetch';\nimport path from 'path';\nimport uglify from 'uglify-js';\nimport { fs, mkdirp } from '../libs';\nimport Writer from './writer';\n\nimport {\n    Internal,\n    escape,\n    freeText,\n    freeLint,\n    freeContext,\n    padLeft,\n    requireText,\n} from '../utils';\n\nconst _ = Symbol('_ScriptWriter');\n\n@Internal(_)\nclass ScriptWriter extends Writer {\n    get scripts() {\n        return this[_].scripts.slice();\n    }\n\n    get prefetch() {\n        return this[_].prefetch;\n    }\n\n    set prefetch(prefetch) {\n        return (this[_].prefetch = !!prefetch);\n    }\n\n    get baseUrl() {\n        return this[_].baseUrl;\n    }\n\n    set baseUrl(baseUrl) {\n        this[_].baseUrl = String(baseUrl);\n    }\n\n    constructor(options = {}) {\n        super();\n\n        this[_].scripts = [];\n\n        this.baseUrl = options.baseUrl;\n        this.prefetch = options.prefetch;\n    }\n\n    async write(dir, options) {\n        await mkdirp(dir);\n\n        options = {\n            ...options,\n            prefetch: this.prefetch,\n        };\n\n        const indexFilePath = `${dir}/index.js`;\n        const childFilePaths = [indexFilePath];\n\n        if (!options.prefetch) {\n            await fs.writeFile(indexFilePath, this[_].composeScriptLoader());\n            return childFilePaths;\n        }\n\n        const scriptFileNames = this.scripts.map(\n            (script, index, { length }) => {\n                const fileName = padLeft(index, length / 10 + 1, 0) + '.js';\n                const filePath = `${dir}/${fileName}`;\n                childFilePaths.push(filePath);\n\n                return fileName;\n            }\n        );\n\n        const fetchingScripts = this.scripts.map(async (script, index) => {\n            const scriptFileName = scriptFileNames[index];\n\n            let code =\n                script.type == 'code'\n                    ? script.body\n                    : /^http/.test(script.body)\n                    ? await fetch(script.body)\n                          .then(res => res.text())\n                          .then(text => uglify.minify(text).code)\n                    : requireText(`${this.baseUrl}/${script.body}`);\n            code = code.replace(/\\n\\/\\/# ?sourceMappingURL=.*\\s*$/, '');\n            code = freeContext(code);\n\n            return fs.writeFile(`${dir}/${scriptFileName}`, code);\n        });\n\n        const scriptsIndexContent = scriptFileNames\n            .map(scriptFileName => {\n                return `import './${scriptFileName}'`;\n            })\n            .join('\\n');\n\n        const writingIndex = fs.writeFile(\n            indexFilePath,\n            freeLint(scriptsIndexContent)\n        );\n\n        await Promise.all([...fetchingScripts, writingIndex]);\n\n        return childFilePaths;\n    }\n\n    setScript(src, content) {\n        let type;\n        let body;\n\n        if (src) {\n            type = 'src';\n            body = /^\\w+:\\/\\//.test(src) ? src : path.resolve('/', src);\n        } else {\n            type = 'code';\n            body = uglify.minify(content).code;\n        }\n\n        const exists = this[_].scripts.some(script => {\n            return script.body == body;\n        });\n\n        if (!exists) {\n            this[_].scripts.push({ type, body });\n        }\n    }\n\n    _composeScriptLoader() {\n        const scripts = this[_].scripts\n            .map(script => {\n                return freeText(`\n        {\n          type: '${script.type}',\n          body: '${escape(script.body, \"'\")}',\n        },\n      `);\n            })\n            .join('\\n');\n\n        return freeLint(`\n      const scripts = [\n        ==>${scripts}<==\n      ]\n\n      const loadingScripts = scripts.reduce((loaded, script) => loaded.then(() => {\n        const scriptEl = document.createElement('script')\n        scriptEl.type = 'text/javascript'\n        let loading\n\n        if (script.type === 'src') {\n          scriptEl.src = script.body\n\n          loading = new Promise((resolve, reject) => {\n            scriptEl.onload = resolve\n            scriptEl.onerror = reject\n          })\n        }\n        else {\n          scriptEl.innerHTML = script.body\n\n          loading = Promise.resolve()\n        }\n\n        document.head.appendChild(scriptEl)\n\n        return loading\n      }), Promise.resolve())\n\n      export default loadingScripts\n    `);\n    }\n}\n\nexport default ScriptWriter;\n","module.exports = require(\"node-fetch\");","import CleanCSS from 'clean-css';\nimport fetch from 'node-fetch';\nimport path from 'path';\nimport { fs, mkdirp } from '../libs';\nimport Writer from './writer';\n\nimport {\n    Internal,\n    escape,\n    freeText,\n    freeLint,\n    padLeft,\n    requireText,\n} from '../utils';\n\nconst _ = Symbol('_StyleWriter');\nconst cleanCSS = new CleanCSS({\n    rebaseTo: '..',\n});\n\n@Internal(_)\nclass StyleWriter extends Writer {\n    get styles() {\n        return this[_].styles.slice();\n    }\n\n    get prefetch() {\n        return this[_].prefetch;\n    }\n\n    set prefetch(prefetch) {\n        return (this[_].prefetch = !!prefetch);\n    }\n\n    get baseUrl() {\n        return this[_].baseUrl;\n    }\n\n    set baseUrl(baseUrl) {\n        this[_].baseUrl = String(baseUrl);\n    }\n\n    get source() {\n        return this[_].source;\n    }\n\n    set source(source) {\n        this[_].source = String(source);\n    }\n\n    constructor(options = {}) {\n        super();\n\n        this[_].styles = [];\n\n        this.baseUrl = options.baseUrl;\n        this.prefetch = options.prefetch;\n        this.source = options.srouce;\n    }\n\n    async write(dir, options) {\n        await mkdirp(dir);\n\n        options = {\n            ...options,\n            prefetch: this.prefetch,\n        };\n\n        const indexFilePath = `${dir}/index.js`;\n        const childFilePaths = [indexFilePath];\n\n        if (!options.prefetch) {\n            await fs.writeFile(indexFilePath, this[_].composeStyleLoader());\n            return childFilePaths;\n        }\n\n        const styleFileNames = this.styles.map((style, index, { length }) => {\n            const fileName = padLeft(index, length / 10 + 1, 0) + '.css';\n            const filePath = `${dir}/${fileName}`;\n            childFilePaths.push(filePath);\n\n            return fileName;\n        });\n\n        const fetchingStyles = this.styles.map(async (style, index) => {\n            const styleFileName = styleFileNames[index];\n\n            const sheet =\n                style.type == 'sheet'\n                    ? style.body\n                    : /^http/.test(style.body)\n                    ? await fetch(style.body).then(res => res.text())\n                    : await requireText.promise(\n                          `${this.baseUrl}/${style.body}`\n                      );\n\n            return fs.writeFile(\n                `${dir}/${styleFileName}`,\n                this[_].transformSheet(sheet)\n            );\n        });\n\n        const stylesIndexContent = styleFileNames\n            .map(styleFileName => {\n                return `import './${styleFileName}'`;\n            })\n            .join('\\n');\n\n        const writingIndex = fs.writeFile(\n            indexFilePath,\n            freeLint(stylesIndexContent)\n        );\n\n        await Promise.all([...fetchingStyles, writingIndex]);\n\n        return childFilePaths;\n    }\n\n    setStyle(href, content) {\n        let type;\n        let body;\n\n        if (href) {\n            type = 'href';\n            body = /^\\w+:\\/\\//.test(href) ? href : path.resolve('/', href);\n        } else {\n            type = 'sheet';\n            body = content;\n        }\n\n        const exists = this[_].styles.some(style => {\n            return style.body == body;\n        });\n\n        if (!exists) {\n            this[_].styles.push({ type, body });\n        }\n    }\n\n    _composeStyleLoader() {\n        this[_].styles.forEach(style => {\n            if (style.type == 'sheet') {\n                style.body = this[_].transformSheet(style.body);\n            }\n        });\n\n        const styles = this[_].styles\n            .map(style => {\n                return freeText(`\n                    {\n                        type: '${style.type}',\n                        body: '${escape(style.body, \"'\")}',\n                    },\n                `);\n            })\n            .join('\\n');\n\n        return freeLint(`\n            const styles = [\n                ==>${styles}<==\n            ]\n\n            const loadingStyles = styles.map((style) => {\n                let styleEl\n                let loading\n\n                if (style.type === 'href') {\n                styleEl = document.createElement('link')\n\n                loading = new Promise((resolve, reject) => {\n                    styleEl.onload = resolve\n                    styleEl.onerror = reject\n                })\n\n                styleEl.rel = 'stylesheet'\n                styleEl.type = 'text/css'\n                styleEl.href = style.body\n                }\n                else {\n                styleEl = document.createElement('style')\n                styleEl.type = 'text/css'\n                styleEl.innerHTML = style.body\n\n                loading = Promise.resolve()\n                }\n\n                document.head.appendChild(styleEl)\n\n                return loading\n            })\n        `);\n    }\n\n    // Will minify and encapsulate classes\n    _transformSheet(sheet) {\n        sheet = cleanCSS.minify(sheet).styles;\n\n        // Make URLs absolute so webpack won't throw any errors\n        return sheet.replace(/url\\(([^)]+)\\)/g, (match, url) => {\n            if (/^(.+):\\/\\//.test(url)) return match;\n\n            url = path.resolve('/', url);\n            return `url(${url})`;\n        });\n    }\n}\n\nexport default StyleWriter;\n","module.exports = require(\"clean-css\");"],"sourceRoot":""}